<!DOCTYPE html>
<html lang="en" xmlns:th="http//www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div>product page</div>
    <div>
        <p th:text="${product.name}"></p>
        <p th:text="${product.description}"></p>
        <p th:text="${product.size}"></p>

        <!-- <a th:href="@{/order/products/add?productId={productId}(productId=${product.id})}">test</a> -->
        <button sec:authorize="isAuthenticated()" onclick="addProduct()">장바구니 추가</button>
        <a sec:authorize="isAnonymous()" th:href="@{/login}">구매하기 위해서 로그인해주세요!</a>

        <form  th:object="${orderProductDto}">
            <div class="mb-3">
                <label for="size" class="form-label">사이즈</label>
                <select th:field="*{size}" id="size" name="size" class="form-select">
                    <option value="-" selected disabled hidden>사이즈</option>
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>


    <script>
        const productId = "[[${product.id}]]"
        function addProduct() {
            console.log('addProduct()')

            const xhr = new XMLHttpRequest();
            xhr.open("POST", "/order/products/add?productId=" + productId, true);

            xhr.onload = function () {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    if (xhr.status == 200) {

                        console.log("order success");
                    } else if (xhr.status == 302) {
                        console.log('302')
                    }
                    else {
                        console.log("order failed");
                    }
                }
            }
            xhr.send();
        };
    </script>
</body>

</html>